const permissions = {
    super_admin: {
        properties: ['*'],
        units: ['*'],
        tenants: ['*'],
        caretakers: ['*'],
        agents: ['*'],
        dashboard: ['*'],
        financial: ['*'],
        invoices: ['*'],
        maintenance: ['*'],
        inspections: ['*'],
        communications: ['*'],
        notifications: ['*'],
        reports: ['*'],
        assignments: ['*'],
        leases: ['*'],
        payments: ['*'],
        billing: ['*'],
        tasks: ['*'],
        movements: ['*'],
        conditions: ['*'],
        users: ['*'],
        companies: ['*'],
        checklists: ['*'],
    },
    agency_admin: {
        properties: ['create', 'read', 'update', 'delete', 'archive', 'duplicate', 'settings', 'history'],
        units: ['create', 'read', 'update', 'delete', 'assign', 'release', 'photos', 'status'],
        tenants: ['create', 'read', 'update', 'delete'],
        caretakers: ['create', 'read', 'update', 'delete', 'invite'],
        staff: ['create', 'read', 'update', 'delete', 'invite'],
        agents: ['create', 'read', 'update', 'delete', 'assign'],
        dashboard: ['read', 'kpis', 'charts'],
        financial: ['read', 'overview', 'payments', 'rent-collection'],
        invoices: ['create', 'read', 'update', 'delete', 'send', 'mark-paid', 'export', 'bulk', 'stats'],
        maintenance: ['create', 'read', 'update', 'delete', 'overview'],
        inspections: ['create', 'read', 'update', 'delete', 'overview', 'schedule'],
        communications: ['create', 'read', 'update', 'templates', 'overview'],
        notifications: ['create', 'read', 'update', 'delete', 'bulk'],
        reports: ['read', 'generate'],
        assignments: ['read', 'create', 'update'],
        leases: ['create', 'read', 'update'],
        payments: ['create', 'read', 'update', 'approve', 'delete'],
        agreements: ['create', 'read', 'update'],
        tasks: ['create', 'read', 'update'],
        movements: ['read', 'update'],
        conditions: ['create', 'read', 'update'],
        billing: ['create', 'read', 'update', 'stats'],
        settings: ['read', 'update'],
        users: ['create', 'read', 'update', 'delete'],
        checklists: ['create', 'read', 'update', 'delete'],
    },
    landlord: {
        properties: ['create', 'read', 'update', 'delete', 'archive', 'duplicate', 'settings', 'history'],
        units: ['create', 'read', 'update', 'delete', 'assign', 'release', 'photos', 'status'],
        tenants: ['create', 'read', 'update', 'delete'],
        caretakers: ['create', 'read', 'update', 'delete', 'invite'],
        staff: ['create', 'read', 'update', 'delete', 'invite'],
        agents: ['create', 'read', 'update', 'delete', 'assign'],
        dashboard: ['read', 'update', 'kpis', 'charts'],
        financial: ['read', 'overview', 'payments', 'rent-collection'],
        invoices: ['create', 'read', 'update', 'delete', 'send', 'mark-paid', 'export', 'bulk', 'stats'],
        maintenance: ['create', 'read', 'update', 'delete', 'overview'],
        inspections: ['create', 'read', 'update', 'delete', 'overview', 'schedule'],
        communications: ['create', 'read', 'update', 'templates', 'overview'],
        notifications: ['create', 'read', 'update', 'delete', 'bulk'],
        reports: ['read', 'generate'],
        assignments: ['read', 'create', 'update'],
        leases: ['create', 'read', 'update'],
        payments: ['create', 'read', 'update', 'approve', 'delete'],
        agreements: ['create', 'read', 'update'],
        tasks: ['create', 'read', 'update'],
        movements: ['read', 'update'],
        conditions: ['create', 'read', 'update'],
        billing: ['create', 'read', 'update', 'stats'],
        settings: ['read', 'update'],
        users: ['create', 'read', 'update', 'delete'],
        checklists: ['create', 'read', 'update', 'delete'],
    },
    agent: {
        properties: ['read'],
        units: ['read', 'update', 'assign', 'release'],
        tenants: ['create', 'read', 'update'],
        staff: ['read'],
        dashboard: ['read'],
        invoices: ['create', 'read', 'update', 'send', 'mark-paid', 'export', 'bulk', 'stats'],
        maintenance: ['create', 'read'],
        communications: ['create', 'read'],
        notifications: ['read', 'update'],
        payments: ['create', 'read', 'approve'],
        leases: ['read'],
        assignments: ['read'],
        checklists: ['create', 'read', 'update'],
    },
    caretaker: {
        properties: ['read'],
        units: ['read', 'update', 'photos'],
        tenants: ['read'],
        dashboard: ['read'],
        maintenance: ['create', 'read', 'update', 'overview'],
        tasks: ['read', 'update', 'create'],
        conditions: ['create', 'read', 'update'],
        movements: ['read', 'update'],
        inspections: ['create', 'read', 'update'],
        communications: ['create', 'read'],
        notifications: ['create', 'read', 'update'],
        reports: ['read'],
        leases: ['read'],
        payments: ['create', 'read'],
        assignments: ['read'],
        checklists: ['create', 'read', 'update'],
    },
    tenant: {
        units: ['read'],
        maintenance: ['create', 'read'],
        invoices: ['read'],
        payments: ['read', 'create'], // Allow tenants to read and create (cancel) their own payments
        notifications: ['create', 'read', 'update'],
        communications: ['create', 'read'],
        checklists: ['read', 'update'],
    },
};
export const rbacResource = (resource, action) => (req, res, next) => {
    const user = req.user;
    if (!user)
        return res.status(401).json({ success: false, message: 'Unauthorized' });
    const allowed = permissions[user.role]?.[resource];
    if (!allowed)
        return res.status(403).json({ success: false, message: `Role '${user.role}' does not have permission to '${action}' on '${resource}'` });
    if (!(allowed.includes('*') || allowed.includes(action))) {
        return res.status(403).json({ success: false, message: `Role '${user.role}' does not have permission to '${action}' on '${resource}'` });
    }
    return next();
};
export const buildPermissionMatrix = () => permissions;
